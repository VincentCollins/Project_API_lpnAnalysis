<h1 align="center">实验报告</h1>

<p align="center">（Python与深度学习基础 第一次大作业）</p>
<div align="center"><b>主题：在线识别图片中的车牌号并判断违规情况</b><br/><span style="white-space:pre">制作人：冯宇衡		   学号：PB17061172</span></div>



目录(按住ctrl点击链接以跳转)：

1  <a href="#1">功能描述与使用说明</a>

​	1.1 <a href="#1.1"> 功能总述</a>

​	1.2  <a href="#1.2">使用说明</a>

2  <a href="#2">代码细节</a>

​	2.1  <a href="#2.1">文件</a>

​	2.2  <a href="#2.2">类</a>

​	2.3  <a href="#2.3">一点技巧</a>

3  <a href="#3">总结体会</a>

​	3.1  <a href="#3.1">总述</a>

​	3.2  <a href="#3.2">各种bug与艰难困苦</a>

​		3.2.1  <a href="#3.2.1">GUI相关</a>

​		3.2.2  <a href="#3.2.2">API相关</a>

​		3.2.3  <a href="#3.2.3">git与github</a>

​	3.3  <a href="#3.3">心得</a>

​	3.4  <a href="#3.4">展望</a>



## <a name="1" >1 功能描述与使用说明</a>

### <a name="1.1" >1.1 功能总述</a>

我设计的这个工具允许用户选择一张本地图片，然后程序访问两个网站的API，识别图中的车牌号码，并且判断相应车辆是否违规驾驶（基于用户选择的`City`和`Day`参数）

<img src="http://harukun.top/myfiles/1.png" style="width:260px ">



本实验调用了两个API，一个是百度云只能提供的“图片中车牌号识别”的API，一个是智能聚合网站提供的“限行尾号查询”的API

### <a name="1.2">1.2 使用说明</a>

（最下方的log栏里边会实时显示操作日志，并显示程序执行的结果）

**STEP 1**：在第二栏Parameter Setting里边的下拉框中选择参数`City`和`Day`，用于设置当前车辆所处的地点和时间

**STEP 2**：在第三栏Image Window里边点击`Select an image`选择本地图片文件，选择完成后图片会显示在下方空白处。可以点击`Remove the image`来撤销最近的选择

**STEP 3**： 在第一栏Main switch里面点击`License number analysis`来访问百度云智能提供的API，图片中的车牌号会被识别出来，结果会被显示在log窗口

**STEP 4**： 在第一栏Main switch里面点击`illegality analysis`来访问智能聚合提供的API，我们会得到当前城市在指定星期数的车辆先行情况，上述信息会被显示在log窗口；进一步，程序会结合上一步识别到的车牌号码来判断图片中的车辆是否违反了限号法规，这一信息也会显示在log窗口



## <a name="2">2 代码细节</a>

### <a name="2.1">2.1 文件</a>

***

主要的py文件有三个：

```python
GUI.py
```

```python
lpnAnalyze.py
```

```python
lpnRestrictionInves.py
```

GUI.py文件包含了GUI显示、控制相关的所有内容

lpnAnalyze.py文件包含了访问百度云智能的”车牌号识别“API相关的所有内容

lpnRestrictionInves.py文件包含了访问智能聚合的”限行尾号查询“API相关的所有内容



### <a name="2.2">2.2 类</a>

***

**`API_lpn`类：**

封装了访问”车牌号识别“API所需的指令，并将网页返回的结果存储在`queryResult`变量中

主要函数:`connect()`

***

**`API_illegality`类：**

封装了访问”限行尾号查询“API所需的指令，并将网页返回的结果存储在`queryResult`变量中

主要函数:`query()`

***

**`my_GUI`类：**

在对象初始化时会创建`API_lpn`类的实例`api_lpn`，以及`API_illegality`类的实例`api_ill`，用于调用相关函数，并访问存有API返回信息的变量

`my_GUI`包含了GUI的显示、按钮控制、文本显示与更新、图片显示与更新等功能

包含的函数：

```python
log_print(self,string) #用于更新log窗口信息
```

```python
Start_licenseNumberAnalysis(self) #按钮函数，访问API并在log中显示结果
```

```python
Start_illegalityAnalysis(self) #按钮函数，处理下拉栏中的变量，进行相关的换算，访问API并显示结果
```

``` python
Start_selectingImage(self) #按钮函数，用于选择并显示图片
```

``` python
Start_removingImage(self) #按钮函数，用于撤销当前图片的选择
```



### <a name="2.3">2.3 一点技巧</a>

***

* 在测试阶段可以把API返回的数据信息存到本地的json文件中，之后用测试函数替代正式调用函数，用访问文件来代替访问API，这样做的目的是节约API调用的限制次数（限行尾号API只有200次免费使用机会）



## <a name="3">3 总结体会</a>

### <a name="3.1">3.1 总述</a>

这次大作业所用到的python知识都比较基础，但是内容极其繁琐，并且对于一个初学者来说，不管是GUI设计、API访问还是文件操作都有各种坑

我认为，最主要的问题是不知道那些模块中的函数的实现原理和相互关系，导致使用时完全处于”无脑调用“的状态，结果就是80%的情况下都没能如意地实现想要的功能，并且出错时很难顺利地查错和排错



###　<a name="3.2">3.2 各种bug与艰难困苦</a>

#### <a name="3.2.1">3.2.1 GUI部分</a>

最主要的问题都出在GUI上边（粗略计算，起码花了8个小时），GUI的设计虽然基础，没有什么高妙之处，但是异常繁琐，主要的问题有：

* 为了正确地排版，只能先设计一个大概位置，然后运行显示，移动10px，再运行显示，再移动......如此往复

* 为了保证美观，想给每一个栏目外围设计了一圈边框（如图），

  <img src="http://harukun.top/myfiles/2.png" style="width:400px ">

  但是打死都做不出来，后来好不容易查到可以直接用label实现，又怎么也不能把栏目标题居中。最后是在相关函数的declaration里递归查找才找到了相应的参数设置方法

* 关于下拉栏中变量的调用，必须先定义一个``varible=stringvar()``，然后在下拉框的参数申明里边令`textvariable=varible`才能始终通过`variable`来监视用户选择的信息。坑人的是，要想获取stringvar里边的字符串，必须调用stringvar.get方法！而不能直接用这个对象本身

* 关于图片显示。本身显示一个图片并不麻烦，但是要动态地显示图片就要正确地绑定对象，由于我前面基本上都使用canvass类来显示GUI的组件，而没有用到pack功能，所以所有东西都是静态地铺在窗口上的，要更新图片的话只能覆盖一张新的图片，要删除图片，实际上是在上面蒙了一层跟背景同色的纯色图！

  另外，为了动态显示，必须实时访问filename(图片路径)变量，但是这里就有了个大bug（网上说是用label显示图片时的一个程序漏洞，不能监视到图片地址的变化），导致不能实时显示图片，但奇怪的是，一旦把变量包在self下边之后，label就能监视filename的变化了(也许是因为此时它们处于同一个确定范围(误))

* 图片的缩放显示，问题根源类似，也是因为我没有在一开始正确地选用pack策略。最后是在csdn的小角落里找到了用label显示图片的缩放方式

* ......



#### <a name="3.2.2">3.2.2 API的访问与信息处理</a>

之前我完全没有接触过API，这一次为了熟悉相关功能花费了大量时间。最主要的问题是，官方给的实例代码不完整！而csdn里面各种教程又是把API的访问融在了更复杂的大框架下，比如后端开发，手机java应用之类的，很难找到适合新手阅读的，单纯的API访问的代码教程

遇到的大问题有：

* 我对API返回的数据格式也不了解，导致没有正确处理其中的信息。比如我没有把bytes数据写入变量中就直接用字典index来取用数据中的信息，结果导致出错

* 不熟悉url的格式要求，在用+号连接字符串时不小心输了一个space，但是我的编程经验又完全没能发现这个漏洞，结果导致url指向的位置一直无法连接上
* ......



#### <a name="3.2.3">3.2.3 git与gihub</a>

这也是我第一次系统地接触、学习版本控制系统，说不上有什么大bug，但是仔细阅读廖雪峰的教程和尝试各种操作还是会花不少时间



### <a name="3.3">3.3 心得</a>

虽然为了追求极致（比如GUI排版的设计）会花费非常多时间，应用未知的工具、出错排错也十分痛苦，但是这显然就是程序员成长和自我成就的自然状态

这一次有个很深的体会，就是没有什么问题是通过网上查找解决不了的，只不过最终的那个适用于自己的正确答案被拆成了若干个小块，分散到了数不尽的教程当中，即是说，很难真的顺利找到某篇教程就那么对症下药。我觉得心理层面就要做好这个思想准备，不要烦躁。

虽然这次实验我完全独立完成，但可以想见，如果在恰当的时机请教别人，应该会少走很多弯路。所以真的应该珍惜身边友善的大佬们~



### <a name="3.4">3.4 一点展望</a>

容易发现，我的作品完全是在PC端的，但我实际上在开初是设计要跟移动设备连接。我的设想是利用微信的robo功能，设计一个可以在手机微信上与用户交互的后台机器人，这样就可以在手机上发送图片，然后直接在手机微信上获得违规驾驶的分析结果。

如果有机会，一定要完善这个功能!



